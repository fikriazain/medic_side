<!DOCTYPE html>
{% load static %}
<html>

<head>
  <!-- Basic -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Mobile Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- Site Metas -->
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <link rel="shortcut icon" href="{% static 'images/favicon.png' %}" type="">

  <title> PanDa </title>

  <!-- bootstrap core css -->
  <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.css' %}" />

  <!-- fonts style -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

  <!--owl slider stylesheet -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />

  <!-- font awesome style -->
  <link href="{% static 'css/font-awesome.min.css' %}" rel="stylesheet" />

  <!-- Custom styles for this template -->
  <link href="{% static 'css/style.css' %}" rel="stylesheet" />
  <!-- responsive style -->
  <link href="{% static 'css/responsive.css' %}" rel="stylesheet" />
  
  <title>Chat Page</title>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
    .chat-container {
      max-width: 600px;
      margin: 0 auto;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
      height: 400px;
      overflow-y: scroll;
      background-color: #f9f9f9;
    }
    .chat-box {
      display: flex;
      flex-direction: column;
    }
    .message {
      margin: 5px 0;
      padding: 10px;
      border-radius: 15px;
      max-width: 75%;
      word-wrap: break-word;
    }
    .message.user {
      background-color: #d1e7dd;
      align-self: flex-end;
    }
    .message.bot {
      background-color: #f8d7da;
      align-self: flex-start;
    }
    #message-input {
      width: calc(100% - 90px);
      margin-right: 10px;
    }
    #send-button {
      width: 80px;
    }
  </style>
</head>

<body class="sub_page" onload="firstMessage()">
    <div class="hero_area">
        <div class="hero_bg_box">
          <img src="{% static 'images/hero-bg.png' %}" alt="">
        </div>
        <!-- header section strats --> 
         {% include 'navbar.html' %}
        <!-- end header section -->
    </div>
      <!-- body section -->
    <div class="container mt-5">
        <div class="chat-container">
        <div id="chat-box" class="chat-box"></div>
    </div>
        <div class="input-group mt-3">
        <textarea id="message-input" class="form-control" placeholder="Type your message here..."></textarea>
        <button id="send-button" class="btn btn-primary">Send</button>
    </div>
          {% include 'footer.html' %}

    <script>
        function firstMessage() {
                console.log("First message");
                $.ajax({
                    type: "POST",
                    url: "http://127.0.0.1:8000/chat/first_message/",
                    contentType: "application/json",
                    success: function(response) {
                        // Display response from the language model
                        $('#chat-box').append('<p><strong>Panda:</strong> ' + response.response + '</p>'); // Access 'response' property
                        // Scroll to bottom of chat box
                        $('#chat-box').scrollTop($('#chat-box')[0].scrollHeight);
                    },
                });
            }
            
        $(document).ready(function(){
            // Function to send message to backend API
            function sendMessage(message) {
                $('#chat-box').append('<p><strong>You:</strong> ' + message + '</p>');
                $.ajax({
                    type: "POST",
                    url: "http://127.0.0.1:8000/chat/send_message/",
                    contentType: "application/json",
                    data: JSON.stringify({ input: message }),
                    success: function(response) {
                        // Display response from the language model
                        $('#chat-box').append('<p><strong>Panda:</strong> ' + response.response + '</p>'); // Access 'response' property
                        // Scroll to bottom of chat box
                        $('#chat-box').scrollTop($('#chat-box')[0].scrollHeight);
                    },
                    error: function(xhr, status, error) {
                        console.error("Error:", error);
                    }
                });
            }

            // Event listener for send button
            $('#send-button').click(function() {
                var message = $('#message-input').val().trim();
                if (message !== '') {
                    sendMessage(message);
                    $('#message-input').val('');
                }
            });

            // Pressing enter in input also sends message
            $('#message-input').keypress(function(event){
                if (event.which == 13) {
                    event.preventDefault();
                    $('#send-button').click();
                }
            });
        });
        </script>

    <!-- jQery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- bootstrap js -->
    <script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <!-- owl carousel js -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <!-- custom js -->
    <script type="text/javascript" src="{% static 'js/custom.js' %}"></script>
    <!-- popper js -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <!-- Google Map -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCh39n5U-4IoWpsVGUHWdqB6puEkhRLdmI&callback=myMap"></script>
    <!-- End Google Map -->
</body>
</html>

<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header border-0">
        <h3 class="card-title">Daftar Pesan</h3>
      </div>
      <div class="card-body table-responsive p-1 ">
        <table id="datatable" class="table table-bordered table-hover">
          <thead>
            <tr>
              <th>No</th>
              <th>ID User</th>
              <th>Pesan</th>
            </tr>
          </thead>
          <tbody>
            {% for message in messages %}
            <tr>
              <td> {{ forloop.counter }} </td>
              <td>{{ message.user_id }}</td>
              <td>{{ message.message }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>